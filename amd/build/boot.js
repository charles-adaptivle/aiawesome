define("local_aiawesome/boot",["exports","core/str"],(function(e,t){"use strict";
/**
   * Boot module for AI Awesome plugin.
   * 
   * This module handles the initial setup and integration with Moodle's UI.
   * It injects the chat toggle button and manages the drawer lifecycle.
   *
   * @module     local_aiawesome/boot
   * @copyright  2025 Charles Horton <charles@adaptivle.co.uk>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */async function n(){try{await async function(){const e=await t.getString("chat_toggle_title","local_aiawesome"),n=[".usermenu .dropdown-menu","#user-menu-dropdown",'[data-region="user-menu"] .dropdown-menu','.navbar-nav .dropdown-menu:has([data-title="usermenu"])'];let a=null;for(const t of n)if(a=document.querySelector(t),a)break;if(!a)return console.warn("AI Awesome: Could not find user menu to inject toggle button"),void function(e){const t=document.createElement("button");t.className="aiawesome-floating-toggle",t.setAttribute("data-aiawesome-toggle","true"),t.setAttribute("aria-label",e),t.setAttribute("title",e),t.innerHTML='<i class="fa fa-comments-o" aria-hidden="true"></i>',Object.assign(t.style,{position:"fixed",top:"80px",right:"20px",zIndex:"1050",width:"50px",height:"50px",borderRadius:"50%",backgroundColor:"#007bff",color:"white",border:"none",boxShadow:"0 2px 10px rgba(0,0,0,0.2)",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"18px",transition:"all 0.3s ease"}),t.addEventListener("mouseenter",(()=>{t.style.backgroundColor="#0056b3",t.style.transform="scale(1.1)"})),t.addEventListener("mouseleave",(()=>{t.style.backgroundColor="#007bff",t.style.transform="scale(1)"})),t.addEventListener("click",o),document.body.appendChild(t)}(e);const r=document.createElement("a");r.className="dropdown-item",r.href="#",r.setAttribute("data-aiawesome-toggle","true"),r.setAttribute("aria-label",e),r.setAttribute("role","button"),r.innerHTML=`\n        <i class="icon fa fa-comments-o fa-fw" aria-hidden="true"></i>\n        <span class="menu-action-text">${e}</span>\n    `,r.addEventListener("click",o);try{const e=a.querySelector(".dropdown-divider");e&&e.parentNode===a?a.insertBefore(r,e):a.appendChild(r)}catch(i){a.appendChild(r)}}(),function(){if(document.getElementById("aiawesome-drawer"))return;const e=document.createElement("aside");e.id="aiawesome-drawer",e.className="aiawesome-drawer",e.setAttribute("role","complementary"),e.setAttribute("aria-label","AI Chat"),e.setAttribute("aria-hidden","true"),e.style.display="none",Object.assign(e.style,{position:"fixed",top:"0",right:"0",width:"400px",height:"100vh",backgroundColor:"white",boxShadow:"-2px 0 10px rgba(0,0,0,0.1)",zIndex:"1040",transform:"translateX(100%)",transition:"transform 0.3s ease-in-out",display:"flex",flexDirection:"column"}),document.body.appendChild(e)}(),document.addEventListener("keydown",(e=>{if("Escape"===e.key){const e=document.getElementById("aiawesome-drawer");e&&e.classList.contains("open")&&a()}})),document.addEventListener("click",(e=>{const t=document.getElementById("aiawesome-drawer");t&&t.classList.contains("open")&&(t.contains(e.target)||e.target.hasAttribute("data-aiawesome-toggle")||e.target.closest("[data-aiawesome-toggle]")||a())})),window.addEventListener("resize",(()=>{const e=document.getElementById("aiawesome-drawer");e&&(window.innerWidth<768?e.style.width="100vw":e.style.width="400px")}))}catch(e){console.error("AI Awesome: Failed to initialize UI",e)}}async function o(e){e.preventDefault(),e.stopPropagation();const t=document.getElementById("aiawesome-drawer");if(!t)return;t.classList.contains("open")?a():await async function(){const e=document.getElementById("aiawesome-drawer");if(!e)return;try{e.style.display="flex",e.classList.add("open"),e.setAttribute("aria-hidden","false"),e.style.transform="translateX(0)",await async function(){const e=document.getElementById("aiawesome-drawer");if(!e)return;if(e.hasAttribute("data-app-mounted"))return;try{await new Promise(((t,n)=>{require(["local_aiawesome/simple_app"],(o=>{o&&o.mount?o.mount(e).then((()=>{e.setAttribute("data-app-mounted","true"),t()})).catch(n):n(new Error("Simple app module does not have mount function"))}),(e=>{n(e)}))}))}catch(t){!function(e){e.innerHTML='\n        <div style="padding: 20px; text-align: center; height: 100%; display: flex; flex-direction: column; justify-content: center;">\n            <div style="max-width: 300px; margin: 0 auto;">\n                <h3 style="color: #333; margin-bottom: 15px;">AI Chat Assistant</h3>\n                <div style="color: #666; font-size: 14px; line-height: 1.5;">\n                    <p style="margin-bottom: 10px;">ðŸ¤– The AI chat interface is loading...</p>\n                    <p style="margin-bottom: 15px;">This fallback appears when the main React app fails to load.</p>\n                    <p style="font-size: 12px; color: #999;">\n                        Check the browser console for technical details or try refreshing the page.\n                    </p>\n                </div>\n                <button onclick="this.parentElement.parentElement.parentElement.parentElement.style.display=\'none\'" \n                        style="margin-top: 20px; padding: 8px 16px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">\n                    Close\n                </button>\n            </div>\n        </div>\n    '}(e),e.setAttribute("data-app-mounted","true")}}(),function(e){const t=e.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');if(0===t.length)return;const n=t[0],o=t[t.length-1];setTimeout((()=>n.focus()),100),e.addEventListener("keydown",(e=>{"Tab"===e.key&&(e.shiftKey?document.activeElement===n&&(e.preventDefault(),o.focus()):document.activeElement===o&&(e.preventDefault(),n.focus()))}))}(e),r(!0)}catch(t){console.error("AI Awesome: Failed to open drawer",t),a()}}();const n=e.target.closest(".dropdown");if(n){const e=n.querySelector(".dropdown-menu");e&&e.classList.contains("show")&&e.classList.remove("show")}}function a(){const e=document.getElementById("aiawesome-drawer");if(!e)return;e.classList.remove("open"),e.setAttribute("aria-hidden","true"),e.style.transform="translateX(100%)",setTimeout((()=>{e.classList.contains("open")||(e.style.display="none")}),300),r(!1);const t=document.querySelector("[data-aiawesome-toggle]");t&&t.focus()}function r(e){const t=document.querySelector("[data-aiawesome-toggle]");t&&(t.setAttribute("aria-expanded",e.toString()),e?t.classList.add("active"):t.classList.remove("active"))}e.generateSessionId=function(){return"sess_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)},e.getCurrentCourseId=function(){if(M.cfg.courseId&&1!==M.cfg.courseId)return M.cfg.courseId;const e=window.location.pathname.match(/\/course\/view\.php.*[?&]id=(\d+)/);if(e)return parseInt(e[1],10);const t=document.body.getAttribute("data-course-id");return t&&"1"!==t?parseInt(t,10):null},e.init=()=>{(M.cfg.developerdebug||document.body.hasAttribute("data-aiawesome-enabled"))&&("loading"===document.readyState?document.addEventListener("DOMContentLoaded",n):n())},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
