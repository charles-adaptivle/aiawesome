define("local_aiawesome/boot",["exports","core/str"],(function(e,t){"use strict";
/**
   * Boot module for AI Awesome plugin.
   * 
   * This module handles the initial setup and integration with Moodle's UI.
   * It injects the chat toggle button and manages the drawer lifecycle.
   *
   * @module     local_aiawesome/boot
   * @copyright  2025 Charles Horton <charles@adaptivle.co.uk>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */async function n(){try{await async function(){const e=await t.getString("chat_toggle_title","local_aiawesome"),n=[".usermenu .dropdown-menu","#user-menu-dropdown",'[data-region="user-menu"] .dropdown-menu','.navbar-nav .dropdown-menu:has([data-title="usermenu"])'];let o=null;for(const t of n)if(o=document.querySelector(t),o)break;if(!o)return console.warn("AI Awesome: Could not find user menu to inject toggle button"),void function(e){const t=document.createElement("button");t.className="aiawesome-floating-toggle",t.setAttribute("data-aiawesome-toggle","true"),t.setAttribute("aria-label",e),t.setAttribute("title",e),t.innerHTML='<i class="fa fa-comments-o" aria-hidden="true"></i>',Object.assign(t.style,{position:"fixed",top:"80px",right:"20px",zIndex:"1050",width:"50px",height:"50px",borderRadius:"50%",backgroundColor:"#007bff",color:"white",border:"none",boxShadow:"0 2px 10px rgba(0,0,0,0.2)",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"18px",transition:"all 0.3s ease"}),t.addEventListener("mouseenter",(()=>{t.style.backgroundColor="#0056b3",t.style.transform="scale(1.1)"})),t.addEventListener("mouseleave",(()=>{t.style.backgroundColor="#007bff",t.style.transform="scale(1)"})),t.addEventListener("click",a),document.body.appendChild(t)}(e);const i=document.createElement("a");i.className="dropdown-item",i.href="#",i.setAttribute("data-aiawesome-toggle","true"),i.setAttribute("aria-label",e),i.setAttribute("role","button"),i.innerHTML=`\n        <i class="icon fa fa-comments-o fa-fw" aria-hidden="true"></i>\n        <span class="menu-action-text">${e}</span>\n    `,i.addEventListener("click",a);try{const e=o.querySelector(".dropdown-divider");e&&e.parentNode===o?o.insertBefore(i,e):o.appendChild(i)}catch(s){o.appendChild(i)}}(),function(){if(document.getElementById("aiawesome-drawer"))return;const e=document.createElement("aside");e.id="aiawesome-drawer",e.className="aiawesome-drawer",e.setAttribute("role","complementary"),e.setAttribute("aria-label","AI Chat"),e.setAttribute("aria-hidden","true"),e.style.display="none",Object.assign(e.style,{position:"fixed",top:"0",right:"0",width:"400px",height:"100vh",backgroundColor:"white",boxShadow:"-2px 0 10px rgba(0,0,0,0.1)",zIndex:"1040",transform:"translateX(100%)",transition:"transform 0.3s ease-in-out",display:"flex",flexDirection:"column"}),e.innerHTML='\n        <div class="aiawesome-drawer-loading">\n            <div class="aiawesome-loading-header">\n                <div class="aiawesome-loading-header-title"></div>\n                <div class="aiawesome-loading-header-close"></div>\n            </div>\n            <div class="aiawesome-loading-content">\n                <div class="aiawesome-loading-spinner">\n                    <div class="aiawesome-loading-icon"></div>\n                    <div class="aiawesome-loading-text">\n                        Loading AI Chat<span class="aiawesome-loading-dots-text">...</span>\n                    </div>\n                </div>\n            </div>\n            <div class="aiawesome-loading-input">\n                <div class="aiawesome-loading-input-box"></div>\n            </div>\n        </div>\n    ',document.body.appendChild(e)}(),document.addEventListener("keydown",(e=>{if("Escape"===e.key){const e=document.getElementById("aiawesome-drawer");e&&e.classList.contains("open")&&o()}})),document.addEventListener("click",(e=>{const t=document.getElementById("aiawesome-drawer");t&&t.classList.contains("open")&&(t.contains(e.target)||e.target.hasAttribute("data-aiawesome-toggle")||e.target.closest("[data-aiawesome-toggle]")||o())})),window.addEventListener("resize",(()=>{const e=document.getElementById("aiawesome-drawer");e&&(window.innerWidth<768?e.style.width="100vw":e.style.width="400px")}))}catch(e){console.error("AI Awesome: Failed to initialize UI",e)}}async function a(e){e.preventDefault(),e.stopPropagation();const t=document.getElementById("aiawesome-drawer");if(!t)return;t.classList.contains("open")?o():await async function(){const e=document.getElementById("aiawesome-drawer");if(!e)return;try{e.style.display="flex",e.classList.add("open"),e.setAttribute("aria-hidden","false"),e.style.transform="translateX(0)",await async function(){const e=document.getElementById("aiawesome-drawer");if(!e)return;if(e.hasAttribute("data-app-mounted"))return;try{await new Promise(((t,n)=>{require(["local_aiawesome/simple_app"],(a=>{a&&a.mount?a.mount(e).then((()=>{e.setAttribute("data-app-mounted","true"),t()})).catch(n):n(new Error("Simple app module does not have mount function"))}),(e=>{n(e)}))}))}catch(t){!function(e){e.innerHTML='\n        <div class="aiawesome-drawer-loading">\n            <div class="aiawesome-loading-header">\n                <div style="color: white; font-weight: 600;">AI Chat Assistant</div>\n                <button onclick="this.closest(\'.aiawesome-drawer-loading\').parentElement.style.display=\'none\'" \n                        style="background: rgba(255,255,255,0.3); color: white; border: none; \n                               padding: 0.5rem; border-radius: 50%; cursor: pointer; width: 32px; height: 32px;">\n                    ×\n                </button>\n            </div>\n            <div class="aiawesome-loading-content">\n                <div style="text-align: center; max-width: 300px; margin: 0 auto;">\n                    <div style="font-size: 3rem; margin-bottom: 1rem;">⚠️</div>\n                    <h3 style="color: #333; margin-bottom: 15px;">Module Loading Error</h3>\n                    <div style="color: #666; font-size: 14px; line-height: 1.5;">\n                        <p style="margin-bottom: 10px;">The AI chat interface failed to load.</p>\n                        <p style="margin-bottom: 15px; font-size: 12px; color: #999;">\n                            Check the browser console for technical details or try refreshing the page.\n                        </p>\n                    </div>\n                </div>\n            </div>\n        </div>\n    '}(e),e.setAttribute("data-app-mounted","true")}}(),function(e){const t=e.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');if(0===t.length)return;const n=t[0],a=t[t.length-1];setTimeout((()=>n.focus()),100),e.addEventListener("keydown",(e=>{"Tab"===e.key&&(e.shiftKey?document.activeElement===n&&(e.preventDefault(),a.focus()):document.activeElement===a&&(e.preventDefault(),n.focus()))}))}(e),i(!0)}catch(t){console.error("AI Awesome: Failed to open drawer",t),o()}}();const n=e.target.closest(".dropdown");if(n){const e=n.querySelector(".dropdown-menu");e&&e.classList.contains("show")&&e.classList.remove("show")}}function o(){const e=document.getElementById("aiawesome-drawer");if(!e)return;e.classList.remove("open"),e.setAttribute("aria-hidden","true"),e.style.transform="translateX(100%)",setTimeout((()=>{e.classList.contains("open")||(e.style.display="none")}),300),i(!1);const t=document.querySelector("[data-aiawesome-toggle]");t&&t.focus()}function i(e){const t=document.querySelector("[data-aiawesome-toggle]");t&&(t.setAttribute("aria-expanded",e.toString()),e?t.classList.add("active"):t.classList.remove("active"))}e.generateSessionId=function(){return"sess_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)},e.getCurrentCourseId=function(){if(M.cfg.courseId&&1!==M.cfg.courseId)return M.cfg.courseId;const e=window.location.pathname.match(/\/course\/view\.php.*[?&]id=(\d+)/);if(e)return parseInt(e[1],10);const t=document.body.getAttribute("data-course-id");return t&&"1"!==t?parseInt(t,10):null},e.init=()=>{(M.cfg.developerdebug||document.body.hasAttribute("data-aiawesome-enabled"))&&("loading"===document.readyState?document.addEventListener("DOMContentLoaded",n):n())},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
