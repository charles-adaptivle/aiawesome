define("local_aiawesome/simple_app",["exports","core/str","./boot"],(function(e,t,a){"use strict";
/**
   * AI Awesome Vanilla JS Application
   *
   * @module     local_aiawesome/simple_app
   * @copyright  2025 Charles Horton <charles@adaptivle.co.uk>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */function n(e){return{chat_placeholder:"Ask me anything about this course...",chat_send:"Send",chat_stop:"Stop",chat_clear:"Clear chat",chat_close:"Close",error_network:"Network error. Please check your connection.",error_server:"Server error. Please try again later."}[e]||e}e.mount=async function(e){if(!e)throw new Error("Container element is required");!function(e,t){e.innerHTML=`\n        <div class="aiawesome-app">\n            \x3c!-- Header --\x3e\n            <div class="aiawesome-header">\n                <h3 class="aiawesome-title">AI Chat Assistant</h3>\n                <button class="aiawesome-close-btn" data-action="close" \n                        aria-label="${t.chat_close}" title="${t.chat_close}">\n                    <i class="fa fa-times" aria-hidden="true"></i>\n                </button>\n            </div>\n            \n            \x3c!-- Messages Container --\x3e\n            <div class="aiawesome-messages" id="aiawesome-messages">\n                <div class="aiawesome-welcome">\n                    <div class="aiawesome-welcome-icon">✨</div>\n                    <h4>Welcome to AI Chat</h4>\n                    <p>I'm here to help with your learning! Ask me anything about this course, \n                    get explanations, or request study tips.</p>\n                    <div class="aiawesome-welcome-prompts">\n                        <button class="aiawesome-prompt-btn" data-prompt="Explain the main concepts covered in this course">\n                            <i class="fa fa-book" aria-hidden="true"></i>\n                            <span>Explain course concepts</span>\n                        </button>\n                        <button class="aiawesome-prompt-btn" data-prompt="Help me understand the assignment requirements">\n                            <i class="fa fa-question-circle" aria-hidden="true"></i>\n                            <span>Help with assignments</span>\n                        </button>\n                        <button class="aiawesome-prompt-btn" data-prompt="Give me study tips for this topic">\n                            <i class="fa fa-lightbulb-o" aria-hidden="true"></i>\n                            <span>Get study tips</span>\n                        </button>\n                    </div>\n                </div>\n            </div>\n            \n            \x3c!-- Input Area --\x3e\n            <div class="aiawesome-input-area">\n                <form class="aiawesome-input-form" id="aiawesome-input-form">\n                    <div class="aiawesome-input-container">\n                        <textarea class="aiawesome-input" \n                                id="aiawesome-input" \n                                placeholder="${t.chat_placeholder}"\n                                rows="1"\n                                maxlength="2000"></textarea>\n                        <button type="submit" \n                                class="aiawesome-send-btn" \n                                id="aiawesome-send-btn"\n                                aria-label="${t.chat_send}">\n                            <i class="fa fa-paper-plane" aria-hidden="true"></i>\n                        </button>\n                    </div>\n                    <div class="aiawesome-actions">\n                        <button type="button" \n                                class="aiawesome-action-btn aiawesome-stop-btn" \n                                id="aiawesome-stop-btn" \n                                style="display: none;"\n                                aria-label="${t.chat_stop}">\n                            <i class="fa fa-stop" aria-hidden="true"></i>\n                            ${t.chat_stop}\n                        </button>\n                        <button type="button" \n                                class="aiawesome-action-btn aiawesome-clear-btn" \n                                id="aiawesome-clear-btn"\n                                aria-label="${t.chat_clear}">\n                            <i class="fa fa-trash" aria-hidden="true"></i>\n                            ${t.chat_clear}\n                        </button>\n                    </div>\n                </form>\n            </div>\n            \n            \x3c!-- Status --\x3e\n            <div class="aiawesome-status" id="aiawesome-status" style="display: none;"></div>\n        </div>\n    `}(e,await async function(){const e=["chat_placeholder","chat_send","chat_stop","chat_clear","chat_close","error_network","error_server"],a={};for(const o of e)try{a[o]=await t.getString(o,"local_aiawesome")}catch(s){a[o]=n(o)}return a}()),function(e,t){const n=e.querySelector("#aiawesome-input-form"),s=e.querySelector("#aiawesome-input"),o=e.querySelector("#aiawesome-send-btn"),i=e.querySelector("#aiawesome-stop-btn"),r=e.querySelector("#aiawesome-clear-btn"),c=e.querySelector('[data-action="close"]'),l=e.querySelector("#aiawesome-messages");e.querySelector("#aiawesome-status");let d=!1,u=null,p=a.generateSessionId();function m(){l.querySelectorAll(".aiawesome-prompt-btn").forEach((e=>{e.addEventListener("click",(function(){const e=this.getAttribute("data-prompt");e&&(s.value=e,s.focus(),s.style.height="auto",s.style.height=Math.min(s.scrollHeight,120)+"px")}))}))}function h(e,t){const a=document.createElement("div");a.className=`aiawesome-message aiawesome-message-${e}`;const n=document.createElement("div");return n.className="aiawesome-message-content",n.textContent=t,a.appendChild(n),l.appendChild(a),l.scrollTop=l.scrollHeight,a}async function w(e){d=!0,o.style.display="none",i.style.display="inline-flex";const t=h("assistant","").querySelector(".aiawesome-message-content"),n='<div class="aiawesome-loading-dots" aria-label="Loading response"><span></span><span></span><span></span></div>';t.innerHTML=n;try{u=new AbortController;const n=a.getCurrentCourseId(),o={query:e,session:p,courseid:n,sesskey:M.cfg.sesskey},i=await fetch(M.cfg.wwwroot+"/local/aiawesome/stream.php",{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(o),credentials:"include",signal:u.signal});if(!i.ok)throw new Error(`HTTP ${i.status}: ${i.statusText}`);const r=i.body.getReader(),c=new TextDecoder;let d="",m="";for(t.innerHTML="";;){const{done:e,value:a}=await r.read();if(e)break;d+=c.decode(a,{stream:!0});const n=d.split("\n");d=n.pop();for(const o of n)if(o.startsWith("data: "))try{const e=JSON.parse(o.substring(6));e.choices&&e.choices[0]&&e.choices[0].delta&&e.choices[0].delta.content&&(m+=e.choices[0].delta.content,t.textContent=m,l.scrollTop=l.scrollHeight)}catch(s){}}m||(t.textContent="Sorry, I encountered an error processing your request.",t.className+=" aiawesome-error")}catch(r){"AbortError"===r.name?t.textContent="Response cancelled.":(t.textContent="Sorry, I encountered an error: "+r.message,t.className+=" aiawesome-error")}finally{b()}}function b(){d=!1,o.style.display="inline-flex",i.style.display="none",u=null}function f(){l.innerHTML='\n            <div class="aiawesome-welcome">\n                <div class="aiawesome-welcome-icon">✨</div>\n                <h4>Welcome to AI Chat</h4>\n                <p>I\'m here to help with your learning! Ask me anything about this course, get explanations, or request study tips.</p>\n                <div class="aiawesome-welcome-prompts">\n                    <button class="aiawesome-prompt-btn" data-prompt="Explain the main concepts covered in this course">\n                        <i class="fa fa-book" aria-hidden="true"></i>\n                        <span>Explain course concepts</span>\n                    </button>\n                    <button class="aiawesome-prompt-btn" data-prompt="Help me understand the assignment requirements">\n                        <i class="fa fa-question-circle" aria-hidden="true"></i>\n                        <span>Help with assignments</span>\n                    </button>\n                    <button class="aiawesome-prompt-btn" data-prompt="Give me study tips for this topic">\n                        <i class="fa fa-lightbulb-o" aria-hidden="true"></i>\n                        <span>Get study tips</span>\n                    </button>\n                </div>\n            </div>\n        ',p=a.generateSessionId(),m()}s.addEventListener("input",(function(){this.style.height="auto",this.style.height=Math.min(this.scrollHeight,120)+"px"})),n.addEventListener("submit",(async function(e){e.preventDefault();const t=s.value.trim();t&&!d&&(h("user",t),s.value="",s.style.height="auto",await w(t))})),i.addEventListener("click",(function(){u&&u.abort(),b()})),r.addEventListener("click",(function(){confirm("Clear all messages?")&&f()})),c.addEventListener("click",(function(){const t=e.closest("#aiawesome-drawer");t&&(t.classList.remove("open"),t.setAttribute("aria-hidden","true"),t.style.transform="translateX(100%)",setTimeout((()=>{t.style.display="none"}),300))})),m()}(e)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
