define("local_aiawesome/simple_app",["exports","core/str","./boot"],(function(e,a,t){"use strict";
/**
   * AI Awesome Vanilla JS Application
   *
   * @module     local_aiawesome/simple_app
   * @copyright  2025 Charles Horton <charles@adaptivle.co.uk>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */function n(e){return{chat_placeholder:"Ask me anything about this course...",chat_send:"Send",chat_stop:"Stop",chat_clear:"Clear chat",chat_close:"Close",error_network:"Network error. Please check your connection.",error_server:"Server error. Please try again later."}[e]||e}e.mount=async function(e){if(!e)throw new Error("Container element is required");!function(e,a){e.innerHTML=`\n        <div class="aiawesome-app">\n            \x3c!-- Header --\x3e\n            <div class="aiawesome-header">\n                <h3 class="aiawesome-title">AI Chat Assistant</h3>\n                <button class="aiawesome-close-btn" data-action="close" \n                        aria-label="${a.chat_close}" title="${a.chat_close}">\n                    <i class="fa fa-times" aria-hidden="true"></i>\n                </button>\n            </div>\n            \n            \x3c!-- Messages Container --\x3e\n            <div class="aiawesome-messages" id="aiawesome-messages">\n                <div class="aiawesome-welcome">\n                    <div class="aiawesome-message aiawesome-message-assistant">\n                        <div class="aiawesome-message-content">\n                            <p>ðŸ‘‹ Hello! I'm your AI assistant. I can help you with questions about this course and your learning.</p>\n                            <p>What would you like to know?</p>\n                        </div>\n                    </div>\n                </div>\n            </div>\n            \n            \x3c!-- Input Area --\x3e\n            <div class="aiawesome-input-area">\n                <form class="aiawesome-input-form" id="aiawesome-input-form">\n                    <div class="aiawesome-input-container">\n                        <textarea class="aiawesome-input" \n                                id="aiawesome-input" \n                                placeholder="${a.chat_placeholder}"\n                                rows="1"\n                                maxlength="2000"></textarea>\n                        <button type="submit" \n                                class="aiawesome-send-btn" \n                                id="aiawesome-send-btn"\n                                aria-label="${a.chat_send}">\n                            <i class="fa fa-paper-plane" aria-hidden="true"></i>\n                        </button>\n                    </div>\n                    <div class="aiawesome-actions">\n                        <button type="button" \n                                class="aiawesome-action-btn aiawesome-stop-btn" \n                                id="aiawesome-stop-btn" \n                                style="display: none;"\n                                aria-label="${a.chat_stop}">\n                            <i class="fa fa-stop" aria-hidden="true"></i>\n                            ${a.chat_stop}\n                        </button>\n                        <button type="button" \n                                class="aiawesome-action-btn aiawesome-clear-btn" \n                                id="aiawesome-clear-btn"\n                                aria-label="${a.chat_clear}">\n                            <i class="fa fa-trash" aria-hidden="true"></i>\n                            ${a.chat_clear}\n                        </button>\n                    </div>\n                </form>\n            </div>\n            \n            \x3c!-- Status --\x3e\n            <div class="aiawesome-status" id="aiawesome-status" style="display: none;"></div>\n        </div>\n    `}(e,await async function(){const e=["chat_placeholder","chat_send","chat_stop","chat_clear","chat_close","error_network","error_server"],t={};for(const o of e)try{t[o]=await a.getString(o,"local_aiawesome")}catch(s){t[o]=n(o)}return t}()),function(e,a){const n=e.querySelector("#aiawesome-input-form"),s=e.querySelector("#aiawesome-input"),o=e.querySelector("#aiawesome-send-btn"),i=e.querySelector("#aiawesome-stop-btn"),r=e.querySelector("#aiawesome-clear-btn"),c=e.querySelector('[data-action="close"]'),l=e.querySelector("#aiawesome-messages");e.querySelector("#aiawesome-status");let d=!1,u=null,m=t.generateSessionId();function w(e,a){const t=document.createElement("div");t.className=`aiawesome-message aiawesome-message-${e}`;const n=document.createElement("div");return n.className="aiawesome-message-content",n.textContent=a,t.appendChild(n),l.appendChild(t),l.scrollTop=l.scrollHeight,t}async function h(e){d=!0,o.style.display="none",i.style.display="inline-flex";const a=w("assistant","").querySelector(".aiawesome-message-content");a.innerHTML='<span class="aiawesome-thinking">ðŸ’­ Thinking...</span>';try{u=new AbortController;const s=t.getCurrentCourseId(),o={query:e,session:m,courseid:s,sesskey:M.cfg.sesskey},i=await fetch(M.cfg.wwwroot+"/local/aiawesome/stream.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o),signal:u.signal});if(!i.ok)throw new Error(`HTTP ${i.status}: ${i.statusText}`);const r=i.body.getReader(),c=new TextDecoder;let d="",w="";for(a.innerHTML="";;){const{done:e,value:t}=await r.read();if(e)break;d+=c.decode(t,{stream:!0});const s=d.split("\n");d=s.pop();for(const o of s)if(o.startsWith("data: "))try{const e=JSON.parse(o.substring(6));e.content&&(w+=e.content,a.textContent=w,l.scrollTop=l.scrollHeight)}catch(n){}}w||(a.textContent="Sorry, I encountered an error processing your request.",a.className+=" aiawesome-error")}catch(s){"AbortError"===s.name?a.textContent="Response cancelled.":(a.textContent="Sorry, I encountered an error: "+s.message,a.className+=" aiawesome-error")}finally{p()}}function p(){d=!1,o.style.display="inline-flex",i.style.display="none",u=null}function y(){l.innerHTML='\n            <div class="aiawesome-welcome">\n                <div class="aiawesome-message aiawesome-message-assistant">\n                    <div class="aiawesome-message-content">\n                        <p>ðŸ‘‹ Hello! I\'m your AI assistant. I can help you with questions about this course and your learning.</p>\n                        <p>What would you like to know?</p>\n                    </div>\n                </div>\n            </div>\n        ',m=t.generateSessionId()}s.addEventListener("input",(function(){this.style.height="auto",this.style.height=Math.min(this.scrollHeight,120)+"px"})),n.addEventListener("submit",(async function(e){e.preventDefault();const a=s.value.trim();a&&!d&&(w("user",a),s.value="",s.style.height="auto",await h(a))})),i.addEventListener("click",(function(){u&&u.abort(),p()})),r.addEventListener("click",(function(){confirm("Clear all messages?")&&y()})),c.addEventListener("click",(function(){const a=e.closest("#aiawesome-drawer");a&&(a.classList.remove("open"),a.setAttribute("aria-hidden","true"),a.style.transform="translateX(100%)",setTimeout((()=>{a.style.display="none"}),300))}))}(e)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}));
